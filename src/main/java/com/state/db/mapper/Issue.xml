<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.state.dao.IssueDao">
	<sql id="resultInfo">
		MDATE,AREA,DTIME,MNAME,DRLOE as drole,DSHEET,SHEET_NAME_ as sheetName,DTYPE,DPRINT, SUM_Q as sumQ, AVE_P as aveP,SIDE_ as side,CORRIDOR_ as corridor,h01,h02,h03,h04,h05,h06,h07,h08,h09,h10,h11,h12,h13,h14,h15,h16,h17,h18,h19,h20,h21,h22,h23,h24,h25,h26,h27,h28,h29,h30,h31,h32,h33,h34,h35,h36,h37,h38,h39,h40,h41,h42,h43,h44,h45,h46,h47,h48,h49,h50,h51,h52,h53,h54,h55,h56,h57,h58,h59,h60,h61,h62,h63,h64,h65,h66,h67,h68,h69,h70,h71,h72,h73,h74,h75,h76,h77,h78,h79,h80,h81,h82,h83,h84,h85,h86,h87,h88,h89,h90,h91,h92,h93,h94,h95,h96,sum_price as sumPrice
	</sql>
	 
	<insert id="insertResult" parameterType="ResultPo">
	 	insert into <include refid='public.model' /> CBPM_RESULET
	 		(ID_,MDATE,AREA,DTIME,MNAME,DRLOE,CORRIDOR_,SIDE_,DSHEET,SHEET_NAME_,DTYPE,DPRINT,SUM_Q,AVE_P,h01,h02,h03,h04,h05,h06,h07,h08,h09,h10,h11,h12,h13,h14,h15,h16,h17,h18,h19,h20,h21,h22,h23,h24,h25,h26,h27,h28,h29,h30,h31,h32,h33,h34,h35,h36,h37,h38,h39,h40,h41,h42,h43,h44,h45,h46,h47,h48,h49,h50,h51,h52,h53,h54,h55,h56,h57,h58,h59,h60,h61,h62,h63,h64,h65,h66,h67,h68,h69,h70,h71,h72,h73,h74,h75,h76,h77,h78,h79,h80,h81,h82,h83,h84,h85,h86,h87,h88,h89,h90,h91,h92,h93,h94,h95,h96,sum_price) 
	 	values 
	 		(#{id},#{mdate},#{area},#{dtime},#{mname},#{drole},#{corridor},#{side},#{dsheet},#{sheetName},#{dtype},#{dprint},#{sumQ},#{aveP},#{h01},#{h02},#{h03},#{h04},#{h05},#{h06},#{h07},#{h08},#{h09},#{h10},#{h11},#{h12},#{h13},#{h14},#{h15},#{h16},#{h17},#{h18},#{h19},#{h20},#{h21},#{h22},#{h23},#{h24},#{h25},#{h26},#{h27},#{h28},#{h29},#{h30},#{h31},#{h32},#{h33},#{h34},#{h35},#{h36},#{h37},#{h38},#{h39},#{h40},#{h41},#{h42},#{h43},#{h44},#{h45},#{h46},#{h47},#{h48},#{h49},#{h50},#{h51},#{h52},#{h53},#{h54},#{h55},#{h56},#{h57},#{h58},#{h59},#{h60},#{h61},#{h62},#{h63},#{h64},#{h65},#{h66},#{h67},#{h68},#{h69},#{h70},#{h71},#{h72},#{h73},#{h74},#{h75},#{h76},#{h77},#{h78},#{h79},#{h80},#{h81},#{h82},#{h83},#{h84},#{h85},#{h86},#{h87},#{h88},#{h89},#{h90},#{h91},#{h92},#{h93},#{h94},#{h95},#{h96},#{sumPrice})
	</insert>
	
	
	<delete id="deleteResultByDate" parameterType="String">
		delete from <include refid='public.model' /> CBPM_RESULET where mdate=#{mdate}
	</delete>
	
	<delete id="deleteResultByDateAndDtype" parameterType="string">
    	delete from <include refid='public.model' /> CBPM_RESULET where mdate=#{mdate} 
    	<if test="dtypes!=null and dtypes!='' ">
			 and dtype in 
			 <foreach item="item" index="index" collection="dtypes" 
                         open="(" separator="," close=")">
                        #{item, jdbcType=VARCHAR}
                </foreach>
		 </if>
    	 <if test="drloes!=null and drloes!='' ">
			 and drloe in 
			 <foreach item="item" index="index" collection="drloes" 
                         open="(" separator="," close=")">
                        #{item, jdbcType=VARCHAR}
                </foreach>
		 </if>
  	</delete>
	
	<delete id="delSdcostResultPo" parameterType="String">
		delete from <include refid='public.model' /> CBPM_SDCOST_RESULT where MDATE=#{time} and POSITION=#{position}
	</delete>
	
	<delete id="delSdTotalCostPo" parameterType="String">
		delete from <include refid='public.model' /> CBPM_SD_TOTALCOST where MDATE=#{time} and POSITION=#{position}
	</delete>
	 <select id="getResultIdBySheetName" resultType="DeclarePo">
		select ID from <include refid='public.model' /> CBPM_SHEET_DECL
		where SHEET_NAME=#{sheetName}
	</select>
	 <select id="getDeclarePoById" resultType="DeclarePo">
		select SHEET_NAME AS sheetname,CLEARSTATE from <include refid='public.model' /> CBPM_SHEET_DECL
		where ID=#{sheetId}
	</select>
	
	<select id="selectSheetOfResultByArea" resultType="DeclarePo">
		select distinct td.id,td.sheet_name as sheetName,td.descr,td.mdate,td.area,td.dtime,td.mname,td.drloe
		   from <include refid='public.model' /> CBPM_RESULET tr 
			inner join CBPM_SHEET_DECL td on tr.dsheet=td.id 
			where tr.area=#{area} and tr.mdate=#{mdate} and tr.dprint='1'
	</select>
	<update id="updateResultPo" parameterType="ResultPo">
		update <include refid='public.model' /> CBPM_RESULET
		<set>
		    CLEARQ_I=#{clearQI},
		    CLEARQ_J=#{clearQJ},
		    PRICE_I=#{priceI},
		    PRICE_J=#{priceJ},
		    SUM_Q=#{sumQ},
		    CLEARP_I=#{clearPI},
		    CLEARP_J=#{clearPJ} 
		</set>
		where DSHEET=#{dsheet}
	</update>
	<update id="updateResultPoSd" parameterType="ResultPo">
		update <include refid='public.model' /> CBPM_RESULET
		<set>
			h01=#{h01},h02=#{h02},h03=#{h03},h04=#{h04},h05=#{h05},h06=#{h06},h07=#{h07},h08=#{h08},h09=#{h09},h10=#{h10},h11=#{h11},h12=#{h12},
		    h13=#{h13},h14=#{h14},h15=#{h15},h16=#{h16},h17=#{h17},h18=#{h18},h19=#{h19},h20=#{h20},h21=#{h21},h22=#{h22},h23=#{h23},h24=#{h24},
		    h25=#{h25},h26=#{h26},h27=#{h27},h28=#{h28},h29=#{h29},h30=#{h30},h31=#{h31},h32=#{h32},h33=#{h33},h34=#{h34},h35=#{h35},h36=#{h36},
		    h37=#{h37},h38=#{h38},h39=#{h39},h40=#{h40},h41=#{h41},h42=#{h42},h43=#{h43},h44=#{h44},h45=#{h45},h46=#{h46},h47=#{h47},h48=#{h48},
		    h49=#{h49},h50=#{h50},h51=#{h51},h52=#{h52},h53=#{h53},h54=#{h54},h55=#{h55},h56=#{h56},h57=#{h57},h58=#{h58},h59=#{h59},h60=#{h60},
		    h61=#{h61},h62=#{h62},h63=#{h63},h64=#{h64},h65=#{h65},h66=#{h66},h67=#{h67},h68=#{h68},h69=#{h69},h70=#{h70},h71=#{h71},h72=#{h72},
		    h73=#{h73},h74=#{h74},h75=#{h75},h76=#{h76},h77=#{h77},h78=#{h78},h79=#{h79},h80=#{h80},h81=#{h81},h82=#{h82},h83=#{h83},h84=#{h84},
		    h85=#{h85},h86=#{h86},h87=#{h87},h88=#{h88},h89=#{h89},h90=#{h90},h91=#{h91},h92=#{h92},h93=#{h93},h94=#{h94},h95=#{h95},h96=#{h96}
		</set>
		where dsheet=#{dsheet}
	</update>
	<update id="updatePrint">
		update <include refid='public.model' /> CBPM_RESULET
		<set>
			dprint=#{dprint}
		</set>
		where mdate=#{mdate}
	</update>
	<update id="updateTransTieLine">
		update <include refid='public.model' /> CBPM_TRANSTIELINE
		<set>
			STATUS_=#{state}
		</set>
		where MDATE=#{mdate}
	</update>
	<update id="updateDeclare">
		update <include refid='public.model' /> CBPM_SHEET_DECL
		<set>
			clearstate=#{clearstate}
		</set>
		where mdate=#{mdate}
	</update>
	 <update id="updateSdBill">
		update <include refid='public.model' /> CBPM_SD_TOTALCOST
		<set>
			STATE=#{state}
		</set>
		where MDATE=#{time}
	</update>
	<update id="updateSdCost">
		update <include refid='public.model' /> CBPM_SDCOST_RESULT
		<set>
			STATE=#{state}
		</set>
		where MDATE=#{time}
	</update>
	<update id="updateLineLimit">
		update <include refid='public.model' /> CBPM_LINE_LIMIT
		<set>
			STATE=#{state}
		</set>
		where MDATE=#{mdate}
	</update>
	<sql id="resultPoSumDataInfo">
	    sum(sum_q) sumQ,sum(ave_p) aveP,sum(h01) h01,sum(h02) h02,sum(h03) h03,sum(h04) h04,sum(h05) h05,sum(h06) h06,
		sum(h07) h07,sum(h08) h08,sum(h09) h09,sum(h10) h10,sum(h11) h11,sum(h12) h12,sum(h13) h13,
		sum(h14) h14,sum(h15) h15,sum(h16) h16,sum(h17) h17,sum(h18) h18,sum(h19) h19,sum(h20) h20,
		sum(h21) h21,sum(h22) h22,sum(h23) h23,sum(h24) h24,sum(h25) h25,sum(h26) h26,sum(h27) h27,
		sum(h28) h28,sum(h29) h29,sum(h30) h30,sum(h31) h31,sum(h32) h32,sum(h33) h33,sum(h34) h34,
		sum(h35) h35,sum(h36) h36,sum(h37) h37,sum(h38) h38,sum(h39) h39,sum(h40) h40,sum(h41) h41,
		sum(h42) h42,sum(h43) h43,sum(h44) h44,sum(h45) h45,sum(h46) h46,sum(h47) h47,sum(h48) h48,
		sum(h49) h49,sum(h50) h50,sum(h51) h51,sum(h52) h52,sum(h53) h53,sum(h54) h54,sum(h55) h55,
		sum(h56) h56,sum(h57) h57,sum(h58) h58,sum(h59) h59,sum(h60) h60,sum(h61) h61,sum(h62) h62,
		sum(h63) h63,sum(h64) h64,sum(h65) h65,sum(h66) h66,sum(h67) h67,sum(h68) h68,sum(h69) h69,
		sum(h70) h70,sum(h71) h71,sum(h72) h72,sum(h73) h73,sum(h74) h74,sum(h75) h75,sum(h76) h76,
		sum(h77) h77,sum(h78) h78,sum(h79) h79,sum(h80) h80,sum(h81) h81,sum(h82) h82,sum(h83) h83,
		sum(h84) h84,sum(h85) h85,sum(h86) h86,sum(h87) h87,sum(h88) h88,sum(h89) h89,sum(h90) h90,
		sum(h91) h91,sum(h92) h92,sum(h93) h93,sum(h94) h94,sum(h95) h95,sum(h96) h96
	</sql>
	
	<select id="getResultByArea"  resultType="ResultPo">
		select <include refid='resultPoSumDataInfo' />
		 from <include refid='public.model' /> CBPM_RESULET 
	     where  mdate=#{time}
	     <if test="area!=null and area!='' ">
			and area=#{area} 
		 </if>
	</select>
	<select id="getAreaReportByMonth"  resultType="AreaReportBean">
	select sum(sumQ) as sumq,area,y as year,m as month,sum(clearQJ) as cqq,sum(fdfy) as cqp from  
         (select sum(sum_q) as sumQ,area as area,sum(CLEARQ_J) as clearQJ,sum(FDFY) fdfy,
                 datepart(year,(select left(mdate,4)+'-'+substring(mdate,5,2)+'-'+right(mdate,2))) as y,
                 datepart(month,(select left(mdate,4)+'-'+substring(mdate,5,2)+'-'+right(mdate,2))) as m
                 from <include refid='public.model' /> CBPM_SDCOST_RESULT 
                 where 0=0
                 <if test="startTime!=null and startTime!='' ">
			          and mdate &gt;#{startTime} 
		          </if>
		           <if test="endTime!=null and endTime!='' ">
			           and mdate &lt;#{endTime} 
		          </if>
                 group by mdate,area) 
      group by area,y,m order by m,y desc;
	</select>
	
	<select id="getAreaReportByMonthPage"  resultType="AreaReportBean">
	select *
	from (select a.*, rownum rnum
	from (select sum(sumQ) as sumq,area,y as year,m as month,sum(clearQJ) as cqq,sum(fdfy) as cqp from  
         (select sum(sum_q) as sumQ,area as area,sum(CLEARQ_J) as clearQJ,sum(FDFY) fdfy,
                 datepart(year,(select left(mdate,4)+'-'+substring(mdate,5,2)+'-'+right(mdate,2))) as y,
                 datepart(month,(select left(mdate,4)+'-'+substring(mdate,5,2)+'-'+right(mdate,2))) as m
                 from <include refid='public.model' /> CBPM_SDCOST_RESULT 
                 where 0=0
                 <if test="startTime!=null and startTime!='' ">
			          and mdate &gt;#{startTime} 
		          </if>
		           <if test="endTime!=null and endTime!='' ">
			           and mdate &lt;#{endTime}
		          </if>
                 group by mdate,area) 
      group by area,y,m order by m,y desc) a
		where rownum &lt;= #{end,jdbcType=INTEGER} )
		where rnum &gt; #{start,jdbcType=INTEGER};
	</select>
	
	<select id="getAreaReportByMonthCount" resultType="java.lang.Integer">
		select count(*) from select area from  
         (select sum(sum_q) as sumQ,area,
                 datepart(year,(select left(mdate,4)+'-'+substring(mdate,5,2)+'-'+right(mdate,2))) as y,
                 datepart(month,(select left(mdate,4)+'-'+substring(mdate,5,2)+'-'+right(mdate,2))) as m
                 from <include refid='public.model' /> CBPM_SDCOST_RESULT 
                 where 0=0
                 <if test="startTime!=null and startTime!='' ">
			          and mdate &gt;#{startTime} 
		          </if>
		           <if test="endTime!=null and endTime!='' ">
			           and mdate &lt;#{endTime} 
		          </if>
                 group by mdate,area) 
      group by area,y,m) 
	</select>
	
	<select id="getAreaReportByYear"  resultType="AreaReportBean">
	select *
	from (select a.*, rownum rnum
	from (select AREA,sum(sumQ)/4 as sumq,count(1) as cqq from (select (h01+h02+h03+h04+h05+h06+h08+h09+h10+h11+h12+h13+h14+h15+h16+h17+h18+h19+h20+h21+h22+h23+h24+h25+h26+h27+
            h28+h29+h30+h31+h32+h33+h34+h35+h36+h37+h38+h39+h40+h41+h42+h43+h44+h45+h46+h47+h48+
            h49+h50+h51+h52+h53+h54+h55+h56+h57+h58+h59+h60+h61+h62+h63+h64+h65+h66+h67+h68+h69+
            h70+h71+h72+h73+h74+h75+h76+h77+h78+h79+h80+h81+h82+h83+h84+h85+h86+h87+h88+h89+h90+h91+h92+h93+h94+h95+h96) 
            as sumQ,MDATE,DRLOE as drole,AREA,DTYPE,side_ as side  from <include refid='public.model' />  CBPM_RESULET  
            where DTYPE = '电力' and CORRIDOR_ !='汇总值' and ((DRLOE ='sale' and side_ ='送电侧') or (DRLOE ='buy' and side_ ='受电侧'))
		  <if test="startTime!=null and startTime!='' ">
	          and mdate &gt;=#{startTime} 
          </if>
           <if test="endTime!=null and endTime!='' ">
	           and mdate &lt;#{endTime} 
          </if>
		           ) data where sumQ !=0  group by AREA) a
		where rownum &lt;= #{end,jdbcType=INTEGER} )
		where rnum &gt; #{start,jdbcType=INTEGER};
	</select>
	
	<select id="getAreaReportByYearCount"  resultType="java.lang.Integer">
	select count(1) from (select AREA from (select (h01+h02+h03+h04+h05+h06+h08+h09+h10+h11+h12+h13+h14+h15+h16+h17+h18+h19+h20+h21+h22+h23+h24+h25+h26+h27+
            h28+h29+h30+h31+h32+h33+h34+h35+h36+h37+h38+h39+h40+h41+h42+h43+h44+h45+h46+h47+h48+
            h49+h50+h51+h52+h53+h54+h55+h56+h57+h58+h59+h60+h61+h62+h63+h64+h65+h66+h67+h68+h69+
            h70+h71+h72+h73+h74+h75+h76+h77+h78+h79+h80+h81+h82+h83+h84+h85+h86+h87+h88+h89+h90+h91+h92+h93+h94+h95+h96) 
            as sumQ,MDATE,AREA from <include refid='public.model' /> CBPM_RESULET  
            where DTYPE = '电力' and CORRIDOR_ !='汇总值' and ((DRLOE ='sale' and side_ ='送电侧') or (DRLOE ='buy' and side_ ='受电侧'))
		    <if test="startTime!=null and startTime!='' ">
	          and mdate &gt;#{startTime} 
           </if>
           <if test="endTime!=null and endTime!='' ">
	           and mdate &lt;#{endTime} 
           </if>
		           ) data where sumQ !=0  group by AREA)
	</select>
	
	
<select id="getLineReportByMonth"  resultType="LineReportBean">
	select mcorhr, max(decode(dtype, '反向限额', nvl(sms, 0),0)) as "minq",
       max(decode(dtype, '计划值',nvl(sms, 0), 0)) as "planq",
       max(decode(dtype, '交易功率',nvl(sms, 0), 0)) as "syq",
       max(decode(dtype, '正向限额', nvl(sms, 0),0)) as "maxq",
       y as year,m as month
  from <include refid='public.model' /> 
(
select y,m,mcorhr,dtype,sum(sums) as sms
from <include refid='public.model' /> 
     (select mcorhr,dtype,
        sum(h01+h02+h03+h04+h05+h06+h08+h09+h10+h11+h12+h13+h14+h15+h16+h17+h18+h19+h20+h21+h22+h23+h24+h25+26+h27+
            h28+h29+h30+h31+h32+h33+h34+h35+h36+h37+h38+h39+h40+h41+h42+h43+h44+h45+h46+h47+h48+
            h49+h50+h51+h52+h53+h54+h55+h56+h57+h58+h59+h60+h61+h62+h63+h64+h65+h66+h67+h68+h69+
            h70+h71+h72+h73+h74+h75+h76+h77+h78+h79+h80+h81+h82+h83+h84+h85+h86+h87+h88+h89+h90+h91+h92+h93+h94+h95+h96) as sums,
        
                 datepart(year,(select left(mdate,4)+'-'+substring(mdate,5,2)+'-'+right(mdate,2))) as y,
                 datepart(month,(select left(mdate,4)+'-'+substring(mdate,5,2)+'-'+right(mdate,2))) as m
                 from <include refid='public.model' /> CBPM_LINE_LIMIT
                 where 0=0
                  <if test="startTime!=null and startTime!='' ">
			          and mdate &gt;#{startTime} 
		          </if>
		           <if test="endTime!=null and endTime!='' ">
			           and mdate &lt;#{endTime} 
		          </if>
                 group by mdate,mcorhr,dtype) 
group by y,m,mcorhr,dtype)

group by mcorhr,y,m order by m,y desc;
	</select>
	
	<select id="getLineReportByMonthCount"  resultType="java.lang.Integer">
	select count(*) from <include refid='public.model' />(select mcorhr from <include refid='public.model' /> (
	 select y,m,mcorhr,dtype,sum(sums) as sms
	 from <include refid='public.model' /> 
     (select mcorhr,dtype,
        sum(h01+h02+h03+h04+h05+h06+h08+h09+h10+h11+h12+h13+h14+h15+h16+h17+h18+h19+h20+h21+h22+h23+h24+h25+26+h27+
            h28+h29+h30+h31+h32+h33+h34+h35+h36+h37+h38+h39+h40+h41+h42+h43+h44+h45+h46+h47+h48+
            h49+h50+h51+h52+h53+h54+h55+h56+h57+h58+h59+h60+h61+h62+h63+h64+h65+h66+h67+h68+h69+
            h70+h71+h72+h73+h74+h75+h76+h77+h78+h79+h80+h81+h82+h83+h84+h85+h86+h87+h88+h89+h90+h91+h92+h93+h94+h95+h96) as sums,
        
                 datepart(year,(select left(mdate,4)+'-'+substring(mdate,5,2)+'-'+right(mdate,2))) as y,
                 datepart(month,(select left(mdate,4)+'-'+substring(mdate,5,2)+'-'+right(mdate,2))) as m
                 from <include refid='public.model' /> CBPM_LINE_LIMIT
                 where 0=0
                  <if test="startTime!=null and startTime!='' ">
			          and mdate &gt;#{startTime} 
		          </if>
		           <if test="endTime!=null and endTime!='' ">
			           and mdate &lt;#{endTime} 
		          </if>
                 group by mdate,mcorhr,dtype) 
group by y,m,mcorhr,dtype)
group by mcorhr,y,m);
	</select>
	
	<select id="getLineReportByMonthPage"  resultType="LineReportBean">
	select *
	from <include refid='public.model' /> (select a.*, rownum rnum
	from <include refid='public.model' /> (select mcorhr, max(decode(dtype, '反向限额', nvl(sms, 0),0)) as "minq",
       max(decode(dtype, '计划值',nvl(sms, 0), 0)) as "planq",
       max(decode(dtype, '交易功率',nvl(sms, 0), 0)) as "syq",
       max(decode(dtype, '正向限额', nvl(sms, 0),0)) as "maxq",
       y as year,m as month
  from <include refid='public.model' /> 
(
select y,m,mcorhr,dtype,sum(sums) as sms
from <include refid='public.model' /> 
     (select mcorhr,dtype,
        sum(h01+h02+h03+h04+h05+h06+h08+h09+h10+h11+h12+h13+h14+h15+h16+h17+h18+h19+h20+h21+h22+h23+h24+h25+26+h27+
            h28+h29+h30+h31+h32+h33+h34+h35+h36+h37+h38+h39+h40+h41+h42+h43+h44+h45+h46+h47+h48+
            h49+h50+h51+h52+h53+h54+h55+h56+h57+h58+h59+h60+h61+h62+h63+h64+h65+h66+h67+h68+h69+
            h70+h71+h72+h73+h74+h75+h76+h77+h78+h79+h80+h81+h82+h83+h84+h85+h86+h87+h88+h89+h90+h91+h92+h93+h94+h95+h96) as sums,
        
                 datepart(year,(select left(mdate,4)+'-'+substring(mdate,5,2)+'-'+right(mdate,2))) as y,
                 datepart(month,(select left(mdate,4)+'-'+substring(mdate,5,2)+'-'+right(mdate,2))) as m
                 from <include refid='public.model' /> CBPM_LINE_LIMIT
                 where 0=0
                  <if test="startTime!=null and startTime!='' ">
			          and mdate &gt;#{startTime} 
		          </if>
		           <if test="endTime!=null and endTime!='' ">
			           and mdate &lt;#{endTime} 
		          </if>
                 group by mdate,mcorhr,dtype) 
group by y,m,mcorhr,dtype)

group by mcorhr,y,m order by m,y desc) a
		where rownum &lt;= #{end,jdbcType=INTEGER} )
		where rnum &gt; #{start,jdbcType=INTEGER};
	</select>
	
	<select id="getLineReportByYearCount"  resultType="java.lang.Integer">
	select count(*) from <include refid='public.model' /> (select mcorhr from <include refid='public.model' /> (
	select y,m,mcorhr,dtype from <include refid='public.model' /> 
     (select mcorhr,dtype,       
                 datepart(year,(select left(mdate,4)+'-'+substring(mdate,5,2)+'-'+right(mdate,2))) as y,
                 datepart(month,(select left(mdate,4)+'-'+substring(mdate,5,2)+'-'+right(mdate,2))) as m
                 from <include refid='public.model' /> CBPM_LINE_LIMIT
                 where 0=0
                 <if test="startTime!=null and startTime!='' ">
			          and mdate &gt;#{startTime} 
		          </if>
		           <if test="endTime!=null and endTime!='' ">
			           and mdate &lt;#{endTime} 
		          </if>
                 group by mdate,mcorhr,dtype) 
group by y,m,mcorhr,dtype)
group by mcorhr,y);
	</select>
	
	<select id="getLineReportByYearPage"  resultType="LineReportBean">
	select *
	from <include refid='public.model' /> (select a.*, rownum rnum
	from <include refid='public.model' /> (select mcorhr, max(decode(dtype, '反向限额', nvl(sms, 0),0)) as "minq",
       max(decode(dtype, '计划值',nvl(sms, 0), 0)) as "planq",
       max(decode(dtype, '交易功率',nvl(sms, 0), 0)) as "syq",
       max(decode(dtype, '正向限额', nvl(sms, 0),0)) as "maxq",
       y as year
  from <include refid='public.model' /> 
(
select y,m,mcorhr,dtype,sum(sums) as sms
from <include refid='public.model' /> 
     (select mcorhr,dtype,
        sum(h01+h02+h03+h04+h05+h06+h08+h09+h10+h11+h12+h13+h14+h15+h16+h17+h18+h19+h20+h21+h22+h23+h24+h25+26+h27+
            h28+h29+h30+h31+h32+h33+h34+h35+h36+h37+h38+h39+h40+h41+h42+h43+h44+h45+h46+h47+h48+
            h49+h50+h51+h52+h53+h54+h55+h56+h57+h58+h59+h60+h61+h62+h63+h64+h65+h66+h67+h68+h69+
            h70+h71+h72+h73+h74+h75+h76+h77+h78+h79+h80+h81+h82+h83+h84+h85+h86+h87+h88+h89+h90+h91+h92+h93+h94+h95+h96) as sums,
        
                 datepart(year,(select left(mdate,4)+'-'+substring(mdate,5,2)+'-'+right(mdate,2))) as y,
                 datepart(month,(select left(mdate,4)+'-'+substring(mdate,5,2)+'-'+right(mdate,2))) as m
                 from <include refid='public.model' /> CBPM_LINE_LIMIT
                 where 0=0
                 <if test="startTime!=null and startTime!='' ">
			          and mdate &gt;#{startTime} 
		          </if>
		           <if test="endTime!=null and endTime!='' ">
			           and mdate &lt;#{endTime} 
		          </if>
                 group by mdate,mcorhr,dtype) 
group by y,m,mcorhr,dtype)

group by mcorhr,y order by y desc) a
		where rownum &lt;= #{end,jdbcType=INTEGER} )
		where rnum &gt; #{start,jdbcType=INTEGER};
	</select>
	<select id="getLineReportByYear"  resultType="LineReportBean">
	select mcorhr, max(decode(dtype, '反向限额', nvl(sms, 0),0)) as "minq",
       max(decode(dtype, '计划值',nvl(sms, 0), 0)) as "planq",
       max(decode(dtype, '交易功率',nvl(sms, 0), 0)) as "syq",
       max(decode(dtype, '正向限额', nvl(sms, 0),0)) as "maxq",
       y as year
  from <include refid='public.model' /> 
(
select y,m,mcorhr,dtype,sum(sums) as sms
from <include refid='public.model' /> 
     (select mcorhr,dtype,
        sum(h01+h02+h03+h04+h05+h06+h08+h09+h10+h11+h12+h13+h14+h15+h16+h17+h18+h19+h20+h21+h22+h23+h24+h25+26+h27+
            h28+h29+h30+h31+h32+h33+h34+h35+h36+h37+h38+h39+h40+h41+h42+h43+h44+h45+h46+h47+h48+
            h49+h50+h51+h52+h53+h54+h55+h56+h57+h58+h59+h60+h61+h62+h63+h64+h65+h66+h67+h68+h69+
            h70+h71+h72+h73+h74+h75+h76+h77+h78+h79+h80+h81+h82+h83+h84+h85+h86+h87+h88+h89+h90+h91+h92+h93+h94+h95+h96) as sums,
        
                 datepart(year,(select left(mdate,4)+'-'+substring(mdate,5,2)+'-'+right(mdate,2))) as y,
                 datepart(month,(select left(mdate,4)+'-'+substring(mdate,5,2)+'-'+right(mdate,2))) as m
                 from <include refid='public.model' /> CBPM_LINE_LIMIT
                 where 0=0
                 <if test="startTime!=null and startTime!='' ">
			          and mdate &gt;#{startTime} 
		          </if>
		           <if test="endTime!=null and endTime!='' ">
			           and mdate &lt;#{endTime} 
		          </if>
                 group by mdate,mcorhr,dtype) 
group by y,m,mcorhr,dtype)

group by mcorhr,y order by y desc;
	</select>
	<select id="selectResultByParam" resultType="ResultPo">
		select <include refid="resultInfo" />
			from <include refid='public.model' /> CBPM_RESULET 
			where area=#{area} and mdate=#{mdate} and dtype=#{dtype} 
		 <if test="mname!=null and mname!='' ">
			 and mname=#{mname}
		 </if>
	</select>
	
	<select id="getResultBySheetId" resultType="ResultPo" parameterType="String">
		select <include refid="resultInfo" /> from <include refid='public.model' /> CBPM_RESULET  
		  where dsheet=#{dsheet}  and mdate=#{time} 
	</select>
	
	<select id="getSdBillList" resultType="SdcostResultPo">
		select DTIME,MDATE,AREA,DSHEET,CLEARQ_I as clearQI,CLEARQ_J as clearQJ,SUM_Q as sumQ,SW,SDSD,HZSD,DBSD,XBSD,NDSD,SDFY,FDFY
			from <include refid='public.model' /> CBPM_SDCOST_RESULT
			where MDATE=#{mdate} ORDER BY AREA,DSHEET
		
	</select>
	
	<select id="getSdAreaList" resultType="SdTotalCostPo">
		select DTIME,MDATE,AREA,CLEARQ_I as clearQI,CLEARQ_J as clearQJ,SW,SDSD,HZSD,DBSD,XBSD,NDSD,SDFY,FDFY
			from <include refid='public.model' /> CBPM_SD_TOTALCOST
			where  MDATE=#{mdate}
	</select>
	
	<insert id="addSdcostResultPo" parameterType="SdcostResultPo">
		insert into CBPM_SDCOST_RESULT
		 (DTIME,MDATE,AREA,DSHEET,CLEARQ_I,CLEARQ_J,SUM_Q,SW,SDSD,HZSD,DBSD,XBSD,NDSD,SDFY,FDFY,KQSD,POSITION)
		 values
		 (#{dTime},#{mDate},#{area},#{dSheet},#{clearQI},#{clearQJ},#{sumQ},#{sw},#{sdsd},#{hzsd},#{dbsd},#{xbsd},#{ndsd},#{sdfy},#{fdfy},#{kqsd},#{position})
	</insert>
	
	<insert id="addSdTotalCostPo" parameterType="SdTotalCostPo">
		insert into CBPM_SD_TOTALCOST
		 (DTIME,MDATE,AREA,CLEARQ_I,CLEARQ_J,SW,SDSD,HZSD,DBSD,XBSD,NDSD,SDFY,FDFY,KQSD,POSITION)
		 values
		 (#{dTime},#{mDate},#{area},#{clearQI},#{clearQJ},#{sw},#{sdsd},#{hzsd},#{dbsd},#{xbsd},#{ndsd},#{sdfy},#{fdfy},#{kqsd},#{position})
	</insert>
	<select id="selectProgramInfo" resultType="String" parameterType="String">
		select ITEMSTATE from <include refid='public.model' /> PROGRAM_INFO
		  where ITEMNAME=#{str}
	</select>
	<select id="getAreaTree" resultType="DeclarePo">
		select SHEET_NAME AS MNAME,AREA,DRLOE from <include refid='public.model' /> CBPM_SHEET_DECL where mdate=#{time} ORDER BY AREA,SHEET_NAME
	</select>
	
	<select id="getTreeForResult"  resultType="ResultPo">
		select ID_ as id ,DRLOE as drole,corridor_ as corridor,SIDE_ as side,SHEET_NAME_ as sheetName,AREA,DTYPE,DRLOE as dealer 
		, h01,h02,h03,h04,h05,h06,h07,h08,h09,h10,h11,h12,h13,h14,h15,h16,h17,h18,h19,h20,h21,h22,h23,h24,h25,h26,h27,h28,h29,h30,h31,h32,h33,h34,h35,h36,h37,h38,h39,h40,h41,h42,h43,h44,h45,h46,h47,h48,h49,h50,h51,h52,h53,h54,h55,h56,h57,h58,h59,h60,h61,h62,h63,h64,h65,h66,h67,h68,h69,h70,h71,h72,h73,h74,h75,h76,h77,h78,h79,h80,h81,h82,h83,h84,h85,h86,h87,h88,h89,h90,h91,h92,h93,h94,h95,h96
		from <include refid='public.model' /> CBPM_RESULET where MDATE=#{mdate} 
		
		<if test="area!=null and area!='' ">
			          and area =#{area} 
		</if>
		<if test="status!=null and status!='' ">
			          and dprint =#{status,jdbcType=VARCHAR} 
		</if>
		<if test="dtype!=null and dtype!=''">
			and DTYPE=#{dtype}
		</if>
		order by area asc,corridor asc,sheet_NAME_ asc,DTYPE desc,DRLOE desc
	</select>
	
	<select id="selectResultListByParam" resultType="ResultPo">
		select *,(h01+h02+h03+h04+h05+h06+h07+h08+h09+h10+h11+h12+h13+h14+h15+h16+h17+h18+h19+h20+h21+h22+h23+h24+h25+h26+h27+
         h28+h29+h30+h31+h32+h33+h34+h35+h36+h37+h38+h39+h40+h41+h42+h43+h44+h45+h46+h47+h48+
         h49+h50+h51+h52+h53+h54+h55+h56+h57+h58+h59+h60+h61+h62+h63+h64+h65+h66+h67+h68+h69+
         h70+h71+h72+h73+h74+h75+h76+h77+h78+h79+h80+h81+h82+h83+h84+h85+h86+h87+h88+h89+h90+h91+h92+h93+h94+h95+h96) 
         as sumQ from (select <include refid="resultInfo" />
			from <include refid='public.model' /> CBPM_RESULET 

			where mdate=#{mdate} 
		 <if test="area!=null and area!='' ">
			          and area =#{area} 
		</if>
		<if test="status!=null and status!='' ">
			          and dprint =#{status,jdbcType=VARCHAR} 
		</if>
		and (DRLOE ='sale' or (DRLOE ='buy' and CORRIDOR_ !='汇总值' and SIDE_='受电侧') or (DTYPE='电价' and DRLOE ='buy'))
		order by area asc,sheet_NAME_ asc,DTYPE desc,DRLOE desc) data
	</select>
	
	<select id="getResultById"  resultType="ResultPo">
		select ID_ as id ,SHEET_NAME_ as sheetName,CORRIDOR_ as corridor,* from <include refid='public.model' /> CBPM_RESULET where ID_= #{id} 
	</select>
	
	<select  id="getSumResultByMdate"  resultType="ResultPo">
		select AREA,DRLOE,DTYPE,sum(h01+h02+h03+h04+h05+h06+h08+h09+h10+h11+h12+h13+h14+h15+h16+h17+h18+h19+h20+h21+h22+h23+h24+h25+26+h27+
            h28+h29+h30+h31+h32+h33+h34+h35+h36+h37+h38+h39+h40+h41+h42+h43+h44+h45+h46+h47+h48+
            h49+h50+h51+h52+h53+h54+h55+h56+h57+h58+h59+h60+h61+h62+h63+h64+h65+h66+h67+h68+h69+
            h70+h71+h72+h73+h74+h75+h76+h77+h78+h79+h80+h81+h82+h83+h84+h85+h86+h87+h88+h89+h90+h91+h92+h93+h94+h95+h96) as sumQ from <include refid='public.model' /> CBPM_RESULET r where r.mdate = #{mdate}  
            <if test="area!=null and area!='' ">
			          and area =#{area} 
			</if>
            <if test="dtype!=null and dtype!='' ">
			          and r.DTYPE=#{dtype} 
			</if>
            
            group by AREA,DRLOE,DTYPE order by AREA 
		
	</select>
		
	<select id="getResultByTime"  resultType="ResultPo">
		select *,(h01+h02+h03+h04+h05+h06+h07+h08+h09+h10+h11+h12+h13+h14+h15+h16+h17+h18+h19+h20+h21+h22+h23+h24+h25+h26+h27+
         h28+h29+h30+h31+h32+h33+h34+h35+h36+h37+h38+h39+h40+h41+h42+h43+h44+h45+h46+h47+h48+
         h49+h50+h51+h52+h53+h54+h55+h56+h57+h58+h59+h60+h61+h62+h63+h64+h65+h66+h67+h68+h69+
         h70+h71+h72+h73+h74+h75+h76+h77+h78+h79+h80+h81+h82+h83+h84+h85+h86+h87+h88+h89+h90+h91+h92+h93+h94+h95+h96) 
         as sumQ from (select MDATE,DRLOE AS DROLE,AREA,DTYPE,SIDE_ as side,CORRIDOR_ as corridor, 
        h01,h02,h03,h04,h05,h06,h07,h08,h09,h10,h11,h12,h13,h14,h15,h16,h17,h18,h19,h20,h21,h22,h23,h24,h25,h26,h27,h28,h29,h30,h31,h32,h33,h34,h35,h36,h37,h38,h39,h40,h41,h42,h43,h44,h45,h46,h47,h48,h49,h50,h51,h52,h53,h54,h55,h56,h57,h58,h59,h60,h61,h62,h63,h64,h65,h66,h67,h68,h69,h70,h71,h72,h73,h74,h75,h76,h77,h78,h79,h80,h81,h82,h83,h84,h85,h86,h87,h88,h89,h90,h91,h92,h93,h94,h95,h96
        from  <include refid='public.model' /> CBPM_RESULET where MDATE between #{startTime} and #{endTime} and 
 ((DRLOE ='sale' and CORRIDOR_ ='汇总值') or (DRLOE ='buy' and CORRIDOR_ !='汇总值' and SIDE_='受电侧') 
 or (DTYPE='电价' and DRLOE ='buy')) ) data
	</select>
	<select id="getTotalResultByTime"  resultType="ResultPo">
		select *,(h01+h02+h03+h04+h05+h06+h07+h08+h09+h10+h11+h12+h13+h14+h15+h16+h17+h18+h19+h20+h21+h22+h23+h24+h25+h26+h27+
         h28+h29+h30+h31+h32+h33+h34+h35+h36+h37+h38+h39+h40+h41+h42+h43+h44+h45+h46+h47+h48+
         h49+h50+h51+h52+h53+h54+h55+h56+h57+h58+h59+h60+h61+h62+h63+h64+h65+h66+h67+h68+h69+
         h70+h71+h72+h73+h74+h75+h76+h77+h78+h79+h80+h81+h82+h83+h84+h85+h86+h87+h88+h89+h90+h91+h92+h93+h94+h95+h96) 
         as sumQ from (select MDATE,DRLOE AS DROLE,AREA,DTYPE,SIDE_ as side,CORRIDOR_ as corridor, 
        h01,h02,h03,h04,h05,h06,h07,h08,h09,h10,h11,h12,h13,h14,h15,h16,h17,h18,h19,h20,h21,h22,h23,h24,h25,h26,h27,h28,h29,h30,h31,h32,h33,h34,h35,h36,h37,h38,h39,h40,h41,h42,h43,h44,h45,h46,h47,h48,h49,h50,h51,h52,h53,h54,h55,h56,h57,h58,h59,h60,h61,h62,h63,h64,h65,h66,h67,h68,h69,h70,h71,h72,h73,h74,h75,h76,h77,h78,h79,h80,h81,h82,h83,h84,h85,h86,h87,h88,h89,h90,h91,h92,h93,h94,h95,h96
        from  <include refid='public.model' /> CBPM_RESULET where MDATE = #{mdate} and CORRIDOR_ ='汇总值' and DTYPE='电力' ) data
	</select>
	<select  id="getResultByIds"  resultType="ResultPo">
		select sum(h01+h02+h03+h04+h05+h06+h08+h09+h10+h11+h12+h13+h14+h15+h16+h17+h18+h19+h20+h21+h22+h23+h24+h25+26+h27+
            h28+h29+h30+h31+h32+h33+h34+h35+h36+h37+h38+h39+h40+h41+h42+h43+h44+h45+h46+h47+h48+
            h49+h50+h51+h52+h53+h54+h55+h56+h57+h58+h59+h60+h61+h62+h63+h64+h65+h66+h67+h68+h69+
            h70+h71+h72+h73+h74+h75+h76+h77+h78+h79+h80+h81+h82+h83+h84+h85+h86+h87+h88+h89+h90+h91+h92+h93+h94+h95+h96) as sumQ from <include refid='public.model' /> CBPM_RESULET r 
            where ID_ in   
            <foreach collection="ids" item="item"  open="(" separator="," close=")">  
           #{item}  
         </foreach>
		
	</select>
	
	<select id="getResultForAreaByTime"  resultType="ResultPo">
		select *,(h01+h02+h03+h04+h05+h06+h07+h08+h09+h10+h11+h12+h13+h14+h15+h16+h17+h18+h19+h20+h21+h22+h23+h24+h25+h26+h27+
         h28+h29+h30+h31+h32+h33+h34+h35+h36+h37+h38+h39+h40+h41+h42+h43+h44+h45+h46+h47+h48+
         h49+h50+h51+h52+h53+h54+h55+h56+h57+h58+h59+h60+h61+h62+h63+h64+h65+h66+h67+h68+h69+
         h70+h71+h72+h73+h74+h75+h76+h77+h78+h79+h80+h81+h82+h83+h84+h85+h86+h87+h88+h89+h90+h91+h92+h93+h94+h95+h96) 
         as sumQ from (select MDATE,DRLOE AS DROLE,AREA,DTYPE,SIDE_ as side,CORRIDOR_ as corridor, 
        h01,h02,h03,h04,h05,h06,h07,h08,h09,h10,h11,h12,h13,h14,h15,h16,h17,h18,h19,h20,h21,h22,h23,h24,h25,h26,h27,h28,h29,h30,h31,h32,h33,h34,h35,h36,h37,h38,h39,h40,h41,h42,h43,h44,h45,h46,h47,h48,h49,h50,h51,h52,h53,h54,h55,h56,h57,h58,h59,h60,h61,h62,h63,h64,h65,h66,h67,h68,h69,h70,h71,h72,h73,h74,h75,h76,h77,h78,h79,h80,h81,h82,h83,h84,h85,h86,h87,h88,h89,h90,h91,h92,h93,h94,h95,h96
        from  <include refid='public.model' /> CBPM_RESULET where MDATE = #{time} and AREA=#{area} and
 (DRLOE ='sale' or (DRLOE ='buy' and CORRIDOR_ !='汇总值' and SIDE_='受电侧') 
 or (DTYPE='电价' and DRLOE ='buy')) ) data
	</select>
	
	<select id="getAreaForTradeByTime"  resultType="String">
		select AREA from  <include refid='public.model' /> CBPM_SHEET_DECL where MDATE = #{time} group by area
	</select>
	
	<select id="getExecuteTree" resultType="TransTielinePo">
		select id_ as id,MDATE,TIELINENAME_ as tielineName,TRANSCORRIDORNAME_ AS transCorridorName,
		SORT_ AS SORT, h01,h02,h03,h04,h05,h06,h07,h08,h09,h10,h11,h12,h13,h14,h15,h16,h17,h18,h19,h20,h21,h22,h23,h24,h25,h26,h27,h28,h29,h30,h31,h32,h33,h34,h35,h36,h37,h38,h39,h40,h41,h42,h43,h44,h45,h46,h47,h48,h49,h50,h51,h52,h53,h54,h55,h56,h57,h58,h59,h60,h61,h62,h63,h64,h65,h66,h67,h68,h69,h70,h71,h72,h73,h74,h75,h76,h77,h78,h79,h80,h81,h82,h83,h84,h85,h86,h87,h88,h89,h90,h91,h92,h93,h94,h95,h96
		 from <include refid='public.model' /> CBPM_EXECUTE_TIELINE where MDATE=#{time} 
		 
		  <if test="status!=null ">
			 and STATUS_=#{status}
		    </if>
		 
		 <if test="area!=null and area!=''">
		 	 and TIELINENAME_ in 
			 	 (select mcorhr from <include refid='public.model' /> CBPM_LINE_DEFINE t where t.START_AREA IN (select area from <include refid='public.model' /> CBPM_AREA  where region in (select region from <include refid='public.model' /> CBPM_AREA  where area=#{area})
			) 		or 
	 		t.END_AREA IN 
	 			(select area from <include refid='public.model' /> CBPM_AREA  where region in (select region from <include refid='public.model' /> CBPM_AREA  where area=#{area})
			))
		 </if>
	</select>
	
	<select id="getExecuteResultById" resultType="TransTielinePo">
		select id_ as id,TIELINENAME_ as tielineName,
		SORT_ AS SORT,h01,h02,h03,h04,h05,h06,h07,h08,h09,h10,h11,h12,h13,h14,h15,h16,h17,h18,h19,h20,h21,h22,h23,h24,h25,h26,h27,h28,h29,h30,h31,h32,h33,h34,h35,h36,h37,h38,h39,h40,h41,h42,h43,h44,h45,h46,h47,h48,h49,h50,h51,h52,h53,h54,h55,h56,h57,h58,h59,h60,h61,h62,h63,h64,h65,h66,h67,h68,h69,h70,h71,h72,h73,h74,h75,h76,h77,h78,h79,h80,h81,h82,h83,h84,h85,h86,h87,h88,h89,h90,h91,h92,h93,h94,h95,h96
		 from <include refid='public.model' /> CBPM_EXECUTE_TIELINE where ID_= #{id} 
	</select>
	
	<select id="getExecuteDataForArea" resultType="TransTielinePo">
		select id_ as id,TIELINENAME_ as tielineName,TRANSCORRIDORNAME_ AS transCorridorName,
		SORT_ AS SORT,h01,h02,h03,h04,h05,h06,h07,h08,h09,h10,h11,h12,h13,h14,h15,h16,h17,h18,h19,h20,h21,h22,h23,h24,h25,h26,h27,h28,h29,h30,h31,h32,h33,h34,h35,h36,h37,h38,h39,h40,h41,h42,h43,h44,h45,h46,h47,h48,h49,h50,h51,h52,h53,h54,h55,h56,h57,h58,h59,h60,h61,h62,h63,h64,h65,h66,h67,h68,h69,h70,h71,h72,h73,h74,h75,h76,h77,h78,h79,h80,h81,h82,h83,h84,h85,h86,h87,h88,h89,h90,h91,h92,h93,h94,h95,h96
		 from <include refid='public.model' /> CBPM_EXECUTE_TIELINE where MDATE=#{time} and TRANSCORRIDORNAME_ !='汇总值' and TRANSCORRIDORNAME_ !='计划值' and TRANSCORRIDORNAME_ !='原计划值'
		 <if test="area!=null and area!=''">
		 	and TRANSCORRIDORNAME_ like '%'+#{area}+'%'
		 </if>
		 <if test="lines!=null">
		 	and TIELINENAME_ in 
		 <foreach item="item" index="index" collection="lines" 
                 open="(" separator="," close=")">
                #{item, jdbcType=VARCHAR}
         </foreach> 
		 </if>
		 
	</select>
	
</mapper>