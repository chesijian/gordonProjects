<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.state.dao.PfOnlineUserDaoI">

	<insert id="insert" parameterType="PfOnlineUserPo">
		INSERT INTO <include refid='public.model' />PF_ONLINE_USER
		(ID_
		,DOC_CREATED_
		,IP_
		,TYPE_
		,USER_ID_
		,USER_NAME_
		,USER_UID_,
		SE_ID_)
		VALUES(
		#{id ,jdbcType=VARCHAR},
		#{docCreated, jdbcType=TIMESTAMP},
		#{ip, jdbcType=VARCHAR},
		#{type ,jdbcType=INTEGER},
		#{userId ,jdbcType=VARCHAR},
		#{userName, jdbcType=VARCHAR},
		#{userUid, jdbcType=VARCHAR},
		#{seId, jdbcType=VARCHAR}
		)
	</insert>

	<resultMap id="PfOnlineUserResultMap" type="PfOnlineUserPo">
		<id property="id" column="ID_" jdbcType="VARCHAR" />
		<result property="docCreated" column="DOC_CREATED_" jdbcType="TIMESTAMP" />
		<result property="createTime" column="CREATE_TIME_" jdbcType="VARCHAR" />
		<result property="ip" column="IP_" jdbcType="VARCHAR" />
		<result property="type" column="TYPE_" jdbcType="VARCHAR" />
		<result property="userName" column="USER_NAME_" jdbcType="VARCHAR" />
		<result property="userId" column="USER_ID_" jdbcType="VARCHAR" />
		<result property="userUid" column="USER_UID_" jdbcType="VARCHAR" />
	</resultMap>

	<sql id="selectOnLineUserSqlWhere">
		<if test="startTime != null and endTime !=null">
			where to_date(t.Doc_CREATED_,'yyyy-MM-dd') between to_date(#{startTime,jdbcType=VARCHAR},'yyyy-MM-dd') and to_date(#{endTime,jdbcType=VARCHAR},'yyyy-MM-dd')
		</if>
		<if test="startTime != null and endTime ==null">
			where to_date(t.Doc_CREATED_,'yyyy-MM-dd') &gt;= to_date(#{startTime,jdbcType=VARCHAR},'yyyy-MM-dd')
		</if>
		<if test="startTime == null and endTime !=null">
			where to_date(t.Doc_CREATED_,'yyyy-MM-dd') &lt;= to_date(#{endTime,jdbcType=VARCHAR},'yyyy-MM-dd')
		</if>
	</sql>

	<select id="selectOnLineUser" resultMap="PfOnlineUserResultMap">
		select *
		from (select a.*, rownum rnum
		from (select
		ID_,USER_ID_,USER_UID_,IP_,USER_NAME_,ID_,to_char(DOC_CREATED_,'YYYY-MM-DD HH24:MI:SS') as CREATE_TIME_
		from <include refid='public.model' /> PF_ONLINE_USER t
		<include refid="selectOnLineUserSqlWhere" />
		order by Doc_created_ desc, rowid) a
		where rownum &lt;= #{end,jdbcType=INTEGER} )
		where rnum &gt; #{start,jdbcType=INTEGER};
	</select>

	<select id="getOnlineUserCount" resultType="java.lang.Long">
		select count(*) from <include refid='public.model' /> PF_ONLINE_USER t
		<include refid="selectOnLineUserSqlWhere" />
	</select>
	
	<delete id="delete">
		delete from <include refid='public.model' /> PF_ONLINE_USER where 
		<if test="userUid != null and sessionId == null">
			USER_UID_ = #{userUid, jdbcType=VARCHAR}
		</if>
		<if test="sessionId != null and userUid == null">
			SE_ID_ = #{sessionId, jdbcType=VARCHAR}
		</if>
		
		<if test="userUid != null and sessionId != null">
			USER_UID_ = #{userUid, jdbcType=VARCHAR} and SE_ID_ = #{sessionId, jdbcType=VARCHAR}
		</if>
		
	</delete>
	
	<delete id="deleteAll">
		delete from <include refid='public.model' /> PF_ONLINE_USER 
	</delete>
	
</mapper>